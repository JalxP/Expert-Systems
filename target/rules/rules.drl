package com.sample

import model.Patient;
import model.MedicalChart;
 
rule "Idade"
	when
		$p: Patient(accepted, age < 18);
	then
		$p.setAccepted(false);
		$p.setResults("O paciente " + $p.getName() + " não é elegível - menor de idade.");
		update($p);
end

rule "Indicador OMS"
	when
		$p: Patient(accepted);
		$mc: MedicalChart(patientID == $p.getPatientID(), OMSIndicator != 0 && OMSIndicator != 1);
	then
		$p.setAccepted(false);
		$p.setResults("O paciente " + $p.getName() + " não é elegível -  não tem o indicador de desempenho requerido.");
		update($p);
end

rule "Diagnóstico"
	when
		$p: Patient(accepted);
		$mc: MedicalChart(patientID == $p.getPatientID(), !carcinomaE, !carcinomaInd, !adenocarcinomaI, !adenocarcinomaII);	
	then
		$p.setAccepted(false);
		$p.setResults("O paciente " + $p.getName() + " não é elegível -  não tem o diagnóstico requerido (Carcinomas, Adenocarcinomas (I ou II).");
		update($p);
end

rule "Doença Clinica"
	when
		$p: Patient(accepted);
		$mc: MedicalChart(patientID == $p.getPatientID(), cancerStage != 2, cancerStage != 3);	
	then
		$p.setAccepted(false);
		$p.setResults("O paciente " + $p.getName() + " não é elegível -  não tem uma doença clínica num	dos estágios requeridos (II ou III).");
		update($p);
end

rule "Distância do Tumor"
	when
		$p: Patient(accepted);
		$mc: MedicalChart(patientID == $p.getPatientID(), distanceToUpperBorder < 3);	
	then
		$p.setAccepted(false);
		$p.setResults("O paciente " + $p.getName() + " não é elegível -  não tem uma distância entre a borda superior\ndo tumor abaixo do esfincter superior do esófago requerida (pelo menos 3cm).");
		update($p);
end

rule "Consentimento Informado"
	when
		$p: Patient(accepted, !consent);	
	then
		$p.setAccepted(false);
		$p.setResults("O paciente " + $p.getName() + " não é elegível -  não tem um termo de consentimento informado.");
		update($p);
end

rule "Mulheres Grávidas ou Lactantes"
	when
		$p: Patient(accepted, pregnant || lactant);	
	then
		$p.setAccepted(false);
		$p.setResults("O paciente " + $p.getName() + " não é elegível -  tem uma gravidez a decorrer ou está lactante.");
		update($p);
end

rule "Radioterapia Prévia"
	when
		$p: Patient(accepted);
		$mc: MedicalChart(patientID == $p.getPatientID(), previousRadiotherapy);	
	then
		$p.setAccepted(false);
		$p.setResults("O paciente " + $p.getName() + " não é elegível -  realizou radioterapia torácica previamente.");
		update($p);
end

rule "Infeção Ativa"
	when
		$p: Patient(accepted);
		$mc: MedicalChart(patientID == $p.getPatientID(), activeInfection);	
	then
		$p.setAccepted(false);
		$p.setResults("O paciente " + $p.getName() + " não é elegível -  infeção ativa.");
		update($p);
end

rule "Neutrófilos"
	when
		$p: Patient(accepted);
		$mc: MedicalChart(patientID == $p.getPatientID(), neutrocytesCount < 1.5);	
	then
		$p.setAccepted(false);
		$p.setResults("O paciente " + $p.getName() + " não é elegível -  contagem de neutrófilos reduzida.");
		update($p);
end

rule "Plaquetas"
	when
		$p: Patient(accepted);
		$mc: MedicalChart(patientID == $p.getPatientID(), plateletsCount < 100);	
	then
		$p.setAccepted(false);
		$p.setResults("O paciente " + $p.getName() + " não é elegível -  contagem de plaquetas reduzida.");
		update($p);
end

rule "Bilirrubina Total"
	when
		$p: Patient(accepted);
		$mc: MedicalChart(patientID == $p.getPatientID(), bilirubinCount > 1.5);	
	then
		$p.setAccepted(false);
		$p.setResults("O paciente " + $p.getName() + " não é elegível -  concentração sérica de bilirrubina elevada.");
		update($p);
end

rule "Creatinina"
	when
		$p: Patient(accepted);
		$mc: MedicalChart(patientID == $p.getPatientID(), creatinineCount > 120);	
	then
		$p.setAccepted(false);
		$p.setResults("O paciente " + $p.getName() + " não é elegível -  creatinina elevada.");
		update($p);
end

rule "Volume Pulmonar"
	when
		$p: Patient(accepted);
		$mc: MedicalChart(patientID == $p.getPatientID(), pulmonarVolume < 1.5);	
	then
		$p.setAccepted(false);
		$p.setResults("O paciente " + $p.getName() + " não é elegível -  volume pulmonar reduzido.");
		update($p);
end

rule "Elegível"
	no-loop true
	when
		$p: Patient(accepted);	
	then
		$p.setResults("O paciente " + $p.getName() + " é elegível.");
		update($p);
end

rule "Efetuar Endoscopia"
	when
		$p: Patient(accepted);
		$mc: MedicalChart(patientID == $p.getPatientID(), endoscopicLesions);
	then
		String s = $p.getResults();
		s += "\nTerá de efetuar uma endoscopia seis semanas após o início do tratamento.";
		$p.setResults(s);
end

rule "Efetuar Broncoscopia"
	when
		$p: Patient(accepted);
		$mc: MedicalChart(patientID == $p.getPatientID(), respiratoryTreeAffected);
	then
		String s = $p.getResults();
		s += "\nTerá de efetuar uma broncoscopia.";
		$p.setResults(s);
end